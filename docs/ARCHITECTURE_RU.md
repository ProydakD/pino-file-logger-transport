# Архитектура pino-file-logger-transport

[English](ARCHITECTURE.md) | [Русский](ARCHITECTURE_RU.md)

## Общая архитектура

Транспорт `pino-file-logger-transport` состоит из одного основного файла `src/transport.ts`, который экспортирует функцию `fileTransport`. Эта функция создает поток записи для логов с различными возможностями.

## Основные компоненты

### 1. Функция `fileTransport`
Главная точка входа, которая создает транспорт для Pino. Принимает параметры конфигурации и возвращает поток записи.

### 2. Система буферизации
Для повышения производительности реализована буферизация записей логов:
- Буфер накапливает логи до достижения `bufferSize`
- Периодическая запись буфера в файл по таймеру `flushInterval`
- Немедленная запись при закрытии транспорта

### 3. Ротация логов
Автоматическая ротация логов происходит при смене календарной даты:
- Создание нового файла с именем `filename-YYYY-MM-DD.log`
- Закрытие предыдущего файла
- Архивация старых логов (опционально)

### 4. Архивация
Поддержка различных форматов архивов:
- ZIP (по умолчанию)
- GZIP (tar.gz)
- TAR (без сжатия)
- None (без архивации)

### 5. Очистка старых файлов
Автоматическое удаление файлов старше `retentionDays` дней.

## Поток данных

```
Pino Logger
    ↓
Transport Options
    ↓
fileTransport()
    ↓
Create Write Stream
    ↓
Log Entries → Buffer → File
    ↓         ↑
Rotate Logs when Date Changes
    ↓
Archive Old Files (optional)
    ↓
Cleanup Old Files
```

## Обработка ошибок

Вся система спроектирована с учетом надежности:
- Ошибки файловой системы не приводят к падению приложения
- Резервные потоки для записи в консоль при проблемах
- Логирование всех ошибок для диагностики

## Производительность

- Асинхронная запись в файлы
- Буферизация для снижения I/O операций
- Неблокирующие операции
- Потоковая обработка данных